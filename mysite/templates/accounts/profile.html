{% extends 'base.html' %}
{% load static %}

{% block content %}
    <link rel="stylesheet" href="{% static 'accounts/style.css' %}">

{% if user.is_authenticated %}
    <div class="profile-dropdown">
        <img src="{% static 'images/pfp.svg' %}" alt="pfp" class="pfp-small">
        <div class="dropdown-content">
            <a href="{% url 'accounts:profile' %}" class="dropdown-link">
                <img src="{% static 'images/profile.svg' %}" alt="" class="icon">
                <span>Profile</span>
            </a>
            <hr>
            <form action="{% url 'accounts:logout' %}?next={% url 'coursefinder:guest_coursefinder' %}"
                  method="post" style="margin:0;padding:0;">
                {% csrf_token %}
                <button type="submit" class="dropdown-link" style="background:none;border:none;">
                    <img src="{% static 'images/logout.svg' %}" alt="" class="icon">
                    <span>Logout</span>
                </button>
            </form>
        </div>
    </div>
    <a href="{% url 'accounts:saved_matches' %}" class="saved-btn">Saved<br>Matches</a>
{% endif %}



    {% if messages %}
        <div id="profile-toast-messages">
            {% for message in messages %}
                <div class="profile-toast {{ message.tags }}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}


    <script>
        setTimeout(() => {
            let el = document.getElementById('profile-toast-messages');
            if (el) el.style.opacity = "0";
        }, 2500);
    </script>

    <div class="profile-bg">
        <!-- sidebar -->
        <div class="profile-side-menu">
            <div class="profile-pfp-big">
                <img src="{% static 'images/pfp.svg' %}" alt="Profile Icon">
            </div>
            <div class="profile-menu">
                <div class="profile-menu-item active">
                    Profile Settings
                </div>
            </div>
            <!-- delete form -->
            <form method="POST" style="width:100%;"
                  onsubmit="return confirm('Are you sure you want to delete your account? This cannot be undone!');">
                {% csrf_token %}
                <button type="submit" name="delete_account" class="delete-account-btn">
                    Delete Account
                </button>
            </form>
        </div>

        <!-- profile form -->
        <form method="POST" class="profile-form">
            {% csrf_token %}
            <div class="profile-form-group">
                <label for="username">Username</label>
                <input type="text" name="username" class="form-input" value="{{ user.username }}" autocomplete="off">
            </div>
            <div class="profile-form-group">
                <label for="email">Email Address</label>
                <input type="email" name="email" class="form-input" value="{{ user.email }}" autocomplete="off">
            </div>
            <div class="profile-form-group">
                <label for="password">New Password</label>
                <input type="password" name="password" class="form-input" autocomplete="off">
            </div>
            <div class="profile-form-group">
                <label for="confirm_password">Confirm Password</label>
                <input type="password" name="confirm_password" class="form-input" autocomplete="off">
            </div>
            <button type="submit" class="save-btn" name="save_changes">Save Changes</button>
        </form>
    </div>
{% endblock %}